{% extends "base.html" %}
{% block title %}Command Injection{% endblock %}
{% block content %}
<h1>Command Injection Lab</h1>
<div class="explanation">
    <strong>What is it?</strong> The server runs a system command (e.g. <code>ping</code>) and puts your input into that command. If it uses a shell and doesn’t sanitize, you can add more commands and run anything the app’s process can run.
</div>
<details class="hints">
    <summary>Hints (click to expand)</summary>
    <ul>
        <li>Normal input: <code>127.0.0.1</code> runs something like <code>ping -c 2 127.0.0.1</code>. Try ending the ping and running another command: <code>127.0.0.1 &amp;&amp; whoami</code> (Linux) or <code>127.0.0.1 &amp; whoami</code> (Windows).</li>
        <li>Other options: <code>; id</code>, <code>| cat /etc/passwd</code>, or <code>$(whoami)</code> (command substitution). The output will appear in the “Ping” result area.</li>
        <li>In Docker the container is Linux, so use Linux commands (<code>whoami</code>, <code>id</code>, <code>cat /etc/passwd</code>). Fix: use an allowlist or an API that doesn’t invoke a shell.</li>
    </ul>
</details>
<div class="exploit-details">
    <p><strong>OWASP:</strong> A03:2021 Injection (CWE-78)</p>
    <p><strong>Impact:</strong> Full command execution as the app user; data exfiltration, backdoor, lateral movement.</p>
    <details><summary>Example payloads</summary>
        <ul>
            <li><code>127.0.0.1 &amp;&amp; whoami</code></li>
            <li><code>; cat /etc/passwd</code></li>
            <li><code>| id</code> or <code>$(id)</code></li>
        </ul>
    </details>
    <p><strong>Remediation:</strong> Avoid shell invocation; use allowlisted inputs or safe APIs (e.g. library to ping); run with minimal privileges.</p>
</div>
<form method="post">
    <label>Host: <input type="text" name="host" value="127.0.0.1" /></label>
    <button type="submit">Ping</button>
</form>
{% if output %}
<pre>{{ output }}</pre>
{% endif %}
{% endblock %}
