{% extends "base.html" %}
{% block title %}Path Traversal{% endblock %}
{% block content %}
<h1>Path Traversal Lab</h1>
<div class="explanation">
    <strong>What is it?</strong> The app serves “files” by taking a filename from you and joining it to a folder path. If it doesn’t sanitize <code>..</code>, you can escape that folder and read arbitrary files (e.g. /etc/passwd on Linux).
</div>
<details class="hints">
    <summary>Hints (click to expand)</summary>
    <ul>
        <li>Normal use: <code>name=welcome.txt</code> reads a file from the intended directory. Try <code>name=../etc/passwd</code> (Linux/Docker) or <code>name=..\..\..\windows\system32\drivers\etc\hosts</code> (Windows) to go up directories.</li>
        <li>You may need several <code>../</code> to reach the root, e.g. <code>....//....//....//etc/passwd</code> or just <code>../../../etc/passwd</code> depending on where the app runs.</li>
        <li>In Docker the app runs on Linux, so <code>/etc/passwd</code> is a good target. The fix is to validate the final path and ensure it stays under the allowed directory.</li>
    </ul>
</details>
<div class="exploit-details">
    <p><strong>OWASP:</strong> A01:2021 Broken Access Control (CWE-22)</p>
    <p><strong>Impact:</strong> Read arbitrary files (config, source code, /etc/passwd); in some cases write (if upload + path traversal).</p>
    <details><summary>Example payloads</summary>
        <ul>
            <li><code>../../../etc/passwd</code> (Linux/Docker)</li>
            <li><code>..\..\..\windows\system32\drivers\etc\hosts</code> (Windows)</li>
        </ul>
    </details>
    <p><strong>Remediation:</strong> Use a safe base path and <code>os.path.realpath</code>; reject if resolved path is not under base; avoid user input in file paths.</p>
    <details><summary>Code example</summary>
        <p><strong>Vulnerable (Python):</strong></p>
        <pre class="code-example"><code>name = request.args.get("name", "welcome.txt")
path = os.path.join(FILES_DIR, name)  # No normalization
return send_file(path)  # name=../../../etc/passwd escapes</code></pre>
        <p><strong>Safe:</strong> <code>real = os.path.realpath(path)</code> then check <code>real.startswith(os.path.realpath(FILES_DIR))</code>.</p>
    </details>
</div>
<form method="get" action="{{ url_for('path_traversal.read') }}">
    <label>Filename: <input type="text" name="name" value="welcome.txt" /></label>
    <button type="submit">Read</button>
</form>
<p>Sample: <a href="{{ url_for('path_traversal.read') }}?name=welcome.txt">welcome.txt</a></p>
{% endblock %}
