{% extends "base.html" %}
{% block title %}SQL Injection{% endblock %}
{% block content %}
<h1>SQL Injection Lab</h1>
<div class="explanation">
    <strong>What is it?</strong> The app builds a SQL query by concatenating your input. If you can break out of the string and add your own SQL, you can read other rows, dump the table, or bypass checks.
</div>
<details class="hints">
    <summary>Hints (click to expand)</summary>
    <ul>
        <li>Think about how the query might look: <code>SELECT ... WHERE username = 'YOUR_INPUT'</code>. What if YOUR_INPUT closes the quote?</li>
        <li>Try a single quote <code>'</code> first—see if you get an error (confirms SQLi).</li>
        <li>To return all users: use something like <code>' OR '1'='1</code> or <code>' OR 1=1 --</code> so the condition is always true.</li>
        <li>To list all columns/tables: in SQLite you can use <code>UNION SELECT</code> with the same number of columns (here: id, username, email).</li>
    </ul>
</details>
<div class="exploit-details">
    <p><strong>OWASP:</strong> A03:2021 Injection</p>
    <p><strong>Impact:</strong> Read, modify, or delete database data; bypass authentication; in some setups, run OS commands or read files.</p>
    <details><summary>Example payloads</summary>
        <ul>
            <li><code>' OR '1'='1</code> – return all rows</li>
            <li><code>' UNION SELECT id, username, password FROM users--</code> – dump passwords (match column count)</li>
            <li><code>'; DROP TABLE users--</code> – destructive (if DB allows multiple statements)</li>
        </ul>
    </details>
    <p><strong>Remediation:</strong> Use parameterized queries or ORM; never concatenate user input into SQL; principle of least privilege for DB user.</p>
</div>
<form method="post">
    <label>Username: <input type="text" name="q" placeholder="e.g. admin" /></label>
    <button type="submit">Search</button>
</form>
{% if results is defined and results %}
<ul>
    {% for r in results %}
    <li>ID: {{ r.id }}, Username: {{ r.username }}, Email: {{ r.email }}</li>
    {% endfor %}
</ul>
{% endif %}
{% endblock %}
